<!DOCTYPE html>

<html lang="en">
<head data-i18n="text_9">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title data-i18n="text_2">Product Details - KeyVault</title>
<!-- Dark Mode Prevention Script -->
<script>
        if (localStorage.theme === "dark" || (!("theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
            document.documentElement.classList.add("dark");
        }
    </script>
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Shared Translation Config -->
<script src="/translate-config.js"></script>
<!-- Google Translate API -->
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
<!-- FontAwesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563EB',
                        secondary: '#1E293B',
                        surface: '#FFFFFF',
                        background: '#F8FAFC',
                        success: '#10B981',
                        danger: '#EF4444',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
<style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box;
            min-width: 0;
        }
        
        html,
        body {
            max-width: 100%;
            overflow-x: hidden;
        }
        
        body { font-family: 'Inter', sans-serif; background-color: #F8FAFC; color: #1E293B; }

        .progress-bar {
            position: fixed; top: 0; left: 0; width: 0%; height: 3px;
            background: linear-gradient(90deg, #2563EB, #3B82F6); z-index: 9999;
        }
        .progress-bar.loading { animation: progress 1.5s ease-in-out infinite; }
        @keyframes progress { 0% { width: 0%; } 50% { width: 70%; } 100% { width: 100%; } }

        .navbar {
            background: #FFFFFF;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: sticky; top: 0; z-index: 100;
        }

        .cart-badge {
            position: absolute; top: -8px; right: -8px;
            background: #EF4444; color: white; font-size: 11px; font-weight: 600;
            min-width: 18px; height: 18px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
        }

        /* Mobile Menu */
        .hamburger-btn {
            display: none;
            flex-direction: column;
            gap: 6px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
        }

        .hamburger-btn span {
            width: 24px;
            height: 3px;
            background: #2563EB;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger-btn.active span:nth-child(1) {
            transform: rotate(45deg) translate(8px, 8px);
        }

        .hamburger-btn.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger-btn.active span:nth-child(3) {
            transform: rotate(-45deg) translate(8px, -8px);
        }

        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 80vw;
            max-width: 320px;
            background: #FFFFFF;
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
            z-index: 200;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        .mobile-menu.active {
            display: flex;
            flex-direction: column;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }

        .mobile-menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 150;
        }

        .mobile-menu-overlay.active {
            display: block;
        }

        .mobile-menu-header {
            padding: 20px;
            border-bottom: 1px solid #E2E8F0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .mobile-menu-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: #1E293B;
        }

        .mobile-menu-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #1E293B;
            padding: 0;
        }

        .mobile-menu-content {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }

        .mobile-menu-item {
            padding: 12px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #1E293B;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
            border-bottom: 1px solid #F1F5F9;
        }

        .mobile-menu-item:hover {
            color: #2563EB;
        }

        .mobile-menu-item i {
            font-size: 18px;
            width: 24px;
        }

        .mobile-menu-divider {
            height: 1px;
            background: #E2E8F0;
            margin: 16px 0;
        }

        .mobile-menu-button-group {
            padding: 20px;
            border-top: 1px solid #E2E8F0;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .mobile-menu-button-group a {
            padding: 12px;
            text-align: center;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s;
        }

        .mobile-menu-button-group .btn-outline {
            background: #F1F5F9;
            color: #1E293B;
            border: 2px solid #E2E8F0;
        }

        .mobile-menu-button-group .btn-outline:hover {
            border-color: #2563EB;
            color: #2563EB;
        }

        .mobile-menu-button-group .btn-primary {
            background: #2563EB;
            color: white;
        }

        .mobile-menu-button-group .btn-primary:hover {
            background: #1D4ED8;
        }

        /* Hide mobile elements on desktop */
        @media (min-width: 768px) {
            .hamburger-btn {
                display: none !important;
            }

            .mobile-menu {
                display: none !important;
            }

            .mobile-menu-overlay {
                display: none !important;
            }
        }

        /* Show mobile elements on mobile */
        @media (max-width: 767px) {
            .hamburger-btn {
                display: flex;
            }

            .navbar-desktop-items {
                display: none;
            }
        }

        .product-image-main {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .product-image-main img {
            width: 100%;
            aspect-ratio: 16/10;
            object-fit: cover;
        }

        .platform-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #F1F5F9;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
        }

        .stock-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            font-weight: 500;
        }

        .stock-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .stock-dot.in-stock { background: #10B981; }
        .stock-dot.out-of-stock { background: #EF4444; }

        .quantity-selector {
            display: flex;
            align-items: center;
            background: #F1F5F9;
            border-radius: 12px;
            overflow: hidden;
        }

        .quantity-btn {
            width: 48px;
            height: 48px;
            border: none;
            background: transparent;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .quantity-btn:hover { background: #E2E8F0; }
        .quantity-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .quantity-input {
            width: 60px;
            height: 48px;
            border: none;
            background: transparent;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
        }

        .quantity-input:focus { outline: none; }

        .btn-primary {
            background: #2563EB; color: white; padding: 16px 32px; border-radius: 12px;
            font-weight: 600; border: none; cursor: pointer; transition: all 0.3s;
            display: inline-flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-primary:hover { background: #1D4ED8; transform: translateY(-2px); }

        .btn-secondary {
            background: #F1F5F9; color: #1E293B; padding: 16px 32px; border-radius: 12px;
            font-weight: 600; border: 2px solid #E2E8F0; cursor: pointer; transition: all 0.3s;
            display: inline-flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-secondary:hover { border-color: #2563EB; color: #2563EB; }

        .description-box {
            background: #FFFFFF;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .related-card {
            background: #FFFFFF;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .related-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12); }

        .footer { background: #1E293B; color: #94A3B8; padding: 60px 0 30px; }
        .footer a { color: #94A3B8; text-decoration: none; transition: color 0.2s; }
        .footer a:hover { color: #FFFFFF; }

        .social-icon {
            width: 40px; height: 40px; background: rgba(255, 255, 255, 0.1);
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            transition: all 0.3s;
        }
        .social-icon:hover { background: #2563EB; color: white; }

        .breadcrumb { display: flex; align-items: center; gap: 8px; font-size: 14px; }
        .breadcrumb a { color: #64748B; }
        .breadcrumb a:hover { color: #2563EB; }
        .breadcrumb span { color: #94A3B8; }

        .skeleton {
            background: linear-gradient(90deg, #F1F5F9 25%, #E2E8F0 50%, #F1F5F9 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: 8px;
        }
        @keyframes skeleton-loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        
        /* Dark Mode Styles */
        html.dark body { background-color: #0F172A; color: #E2E8F0; }
        html.dark .navbar { background: #1E293B; }
        html.dark .footer { background: #0F172A; }
    </style>
</head>
<body data-i18n="text_48" data-i18n-page="blog-detail">
<div class="progress-bar" id="progressBar"></div>
<!-- Navbar -->
<nav class="navbar">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex items-center justify-between h-16 gap-4" data-i18n="text_16">
<a class="flex items-center gap-3 flex-shrink-0" href="/">
<div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center">
<i class="fas fa-key text-white text-lg"></i>
</div>
<span class="text-xl font-bold text-secondary hidden sm:inline" data-i18n="text_49">KeyVault</span>
</a>
<!-- Desktop Items (Hidden on Mobile) -->
<div class="navbar-desktop-items hidden md:flex items-center gap-4 flex-shrink-0">
<button class="p-2 text-secondary hover:text-primary transition rounded-lg hover:bg-gray-100" id="themeToggle" onclick="toggleTheme()" title="Toggle Dark Mode">
<i class="fas fa-moon"></i>
</button>
<div class="flex items-center" id="googleTranslate"></div>
<div class="flex items-center gap-3" id="guestActions">
<a class="px-4 py-2 text-sm font-medium text-primary border-2 border-primary rounded-lg hover:bg-primary hover:text-white transition" data-i18n="text_26" href="/login">Login</a>
<a class="px-4 py-2 text-sm font-medium text-white bg-primary rounded-lg hover:bg-blue-700 transition" data-i18n="text_27" href="/register">Register</a>
</div>
<div class="hidden items-center gap-4" id="userActions">
<a class="flex items-center gap-2 text-sm font-medium text-secondary hover:text-primary transition" href="/profile">
<i class="fas fa-wallet"></i>
<span data-i18n="text_41" id="walletBalance">$0.00</span>
</a>
<button class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition" id="profileBtn">
<i class="fas fa-user text-gray-600"></i>
</button>
</div>
<a class="relative p-2" href="/cart">
<i class="fas fa-shopping-cart text-xl text-secondary hover:text-primary transition"></i>
<span class="cart-badge" id="cartBadge">0</span>
</a>
</div>
<!-- Hamburger Menu Button (Mobile Only) -->
<button aria-label="Open menu" class="hamburger-btn md:hidden" id="hamburgerBtn">
<span></span>
<span></span>
<span></span>
</button>
</div>
</div>
</nav>
<!-- Mobile Menu Overlay -->
<div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
<!-- Mobile Menu -->
<div class="mobile-menu" data-i18n="text_25" id="mobileMenu">
<div class="mobile-menu-header">
<h3 data-i18n="text_19">Menu</h3>
<button aria-label="Close menu" class="mobile-menu-close" id="mobileMenuClose">
<i class="fas fa-times"></i>
</button>
</div>
<div class="mobile-menu-content">
<a class="mobile-menu-item" data-i18n="text_52" href="/">
<i class="fas fa-home"></i>
  Home
  </a>
<a class="mobile-menu-item" href="/inbox.html">
<i class="fas fa-envelope"></i>
<span class="flex-1" data-i18n="text_21">Inbox</span>
<span class="px-2 py-0.5 bg-danger text-white text-xs font-bold rounded-full" id="mobileInboxBadge" style="display: none;"></span>
</a>
<a class="mobile-menu-item" data-i18n="text_22" href="/cart.html">
<i class="fas fa-shopping-cart"></i>
  Cart
  </a>
<a class="mobile-menu-item" data-i18n="text_23" href="/profile.html">
<i class="fas fa-user"></i>
  Profile
  </a>
<div class="mobile-menu-divider"></div>
<div class="mobile-menu-item">
<i class="fas fa-moon"></i>
<button data-i18n="text_24" onclick="toggleTheme()" style="background: none; border: none; cursor: pointer; font-size: 16px; flex: 1; text-align: left;">Dark Mode</button>
</div>
<div class="mobile-menu-item" style="border: none; padding: 12px 0;">
<i class="fas fa-globe"></i>
<div class="flex-1" id="mobileGoogleTranslate"></div>
</div>
</div>
<!-- Mobile Menu Buttons -->
<div class="mobile-menu-button-group" id="mobileAuthButtons">
<a class="btn-outline" data-i18n="text_26" href="/login">Login</a>
<a class="btn-primary" data-i18n="text_27" href="/register">Register</a>
</div>
<div class="mobile-menu-button-group hidden" id="mobileUserButtons">
<button class="btn-outline" data-i18n="text_28" onclick="logout()" style="width: 100%; cursor: pointer;">Logout</button>
</div>
</div>
<!-- Main Content -->
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" data-i18n="text_46">
<!-- Breadcrumb -->
<nav class="breadcrumb mb-8">
<a data-i18n="text_52" href="/">Home</a>
<span>/</span>
<a data-i18n="text_32" href="/?category=gaming">Products</a>
<span>/</span>
<span class="text-secondary font-medium" data-i18n="text_33" id="breadcrumbTitle">Loading...</span>
</nav>
<!-- Product Details -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-12 mb-16" data-i18n="text_35" id="productContent">
<!-- Loading State -->
<div class="skeleton h-80"></div>
<div>
<div class="skeleton h-8 w-3/4 mb-4"></div>
<div class="skeleton h-6 w-1/2 mb-8"></div>
<div class="skeleton h-12 w-1/3 mb-6"></div>
<div class="skeleton h-14 w-full"></div>
</div>
</div>
<!-- Denominations Section -->
<section class="mb-16" id="denominationsSection" style="display: none;">
<div class="max-w-4xl" data-i18n="text_39">
<h2 class="text-2xl font-bold text-secondary mb-8" data-i18n="text_37">Select Denominations</h2>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" data-i18n="text_38" id="denominationsContainer">
<!-- Denominations rendered via JS -->
</div>
<!-- Total Price Display -->
<div class="mt-8 pt-8 border-t border-gray-100">
<div class="flex items-center justify-between mb-6">
<span class="text-lg font-semibold text-secondary" data-i18n="text_40">Total Price</span>
<span class="text-3xl font-bold text-primary" data-i18n="text_41" id="totalPrice">$0.00</span>
</div>
<button class="btn-primary w-full" data-i18n="text_42" disabled="" id="checkoutBtn" onclick="proceedToCheckout()" style="opacity: 0.5; cursor: not-allowed;">
<i class="fas fa-credit-card"></i>
                        Pay Now
                    </button>
<p class="text-sm text-gray-500 text-center mt-4" data-i18n="text_43">Select at least one denomination to proceed</p>
</div>
</div>
</section>
<!-- Description -->
<div class="description-box mb-16" id="descriptionBox" style="display: none;">
<h2 class="text-2xl font-bold text-secondary mb-6" data-i18n="text_45">Product Description</h2>
<div class="prose text-gray-600 leading-relaxed" id="productDescription"></div>
</div>
<!-- Related Products -->
<section id="relatedSection" style="display: none;">
<h2 class="text-2xl font-bold text-secondary mb-8" data-i18n="text_47">You May Also Like</h2>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6" id="relatedProducts"></div>
</section>
</main>
<!-- Footer -->
<footer class="footer">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-12">
<div>
<div class="flex items-center gap-3 mb-4">
<div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center">
<i class="fas fa-key text-white text-lg"></i>
</div>
<span class="text-xl font-bold text-white" data-i18n="text_49">KeyVault</span>
</div>
<p class="text-gray-400 text-sm" data-i18n="text_50">Your trusted source for premium digital keys and gift cards.</p>
</div>
<div>
<h4 class="text-white font-semibold mb-4" data-i18n="text_51">Quick Links</h4>
<ul class="space-y-3 text-sm">
<li><a data-i18n="text_52" href="/">Home</a></li>
<li><a data-i18n="text_53" href="/?filter=featured">Featured</a></li>
<li><a data-i18n="text_54" href="/profile.html">My Account</a></li>
</ul>
</div>
<div>
<h4 class="text-white font-semibold mb-4" data-i18n="text_55">Support</h4>
<ul class="space-y-3 text-sm">
<li><a data-i18n="text_56" href="/faq">FAQ</a></li>
<li><a data-i18n="text_57" href="/contact">Contact Us</a></li>
<li><a data-i18n="text_60" href="/terms">Terms of Service</a></li>
</ul>
</div>
<div>
<h4 class="text-white font-semibold mb-4" data-i18n="text_59">Legal</h4>
<ul class="space-y-3 text-sm">
<li><a data-i18n="text_60" href="/terms">Terms of Service</a></li>
<li><a data-i18n="text_61" href="/privacy">Privacy Policy</a></li>
</ul>
</div>
<div>
<h4 class="text-white font-semibold mb-4" data-i18n="text_62">Connect</h4>
<div class="flex gap-3">
<a class="social-icon" href="#"><i class="fab fa-twitter"></i></a>
<a class="social-icon" href="#"><i class="fab fa-discord"></i></a>
<a class="social-icon" href="#"><i class="fab fa-telegram"></i></a>
</div>
</div>
</div>
<div class="border-t border-gray-700 pt-8 text-center text-sm">
<p data-i18n="text_63">¬© 2026 KeyVault. All rights reserved.</p>
</div>
</div>
</footer>
<script>
        // =========================================================
        // DARK MODE & GOOGLE TRANSLATE
        // =========================================================
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.classList.toggle("dark");
            localStorage.theme = isDark ? "dark" : "light";
            updateThemeIcon();
        }
        
        function updateThemeIcon() {
            const icon = document.getElementById('themeToggle').querySelector('i');
            const isDark = document.documentElement.classList.contains('dark');
            icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
        }
        
        // Note: googleTranslateElementInit is now defined in translate-config.js
        
        document.addEventListener('DOMContentLoaded', updateThemeIcon);
        
        // =========================================================
        // UTILITIES & API
        // =========================================================
        const API_BASE = '';
        let currentProduct = null;
        let selectedDenominations = new Map(); // denomination_id -> price

        const api = {
            getToken: () => localStorage.getItem('token'),
            getHeaders: () => {
                const headers = { 'Content-Type': 'application/json' };
                const token = api.getToken();
                if (token) headers['Authorization'] = `Bearer ${token}`;
                return headers;
            },
            async get(endpoint) {
                showLoader();
                try {
                    const res = await fetch(`${API_BASE}${endpoint}`, { headers: api.getHeaders() });
                    if (res.status === 401) { logout(); throw new Error('Unauthorized'); }
                    return await res.json();
                } finally { hideLoader(); }
            },
            async post(endpoint, data) {
                showLoader();
                try {
                    const res = await fetch(`${API_BASE}${endpoint}`, { 
                        method: 'POST',
                        headers: api.getHeaders(),
                        body: JSON.stringify(data)
                    });
                    if (res.status === 401) { logout(); throw new Error('Unauthorized'); }
                    return await res.json();
                } finally { hideLoader(); }
            }
        };

        const showLoader = () => document.getElementById('progressBar').classList.add('loading');
        const hideLoader = () => {
            document.getElementById('progressBar').classList.remove('loading');
            document.getElementById('progressBar').style.width = '0%';
        };

        const formatCurrency = (amount) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);

        const cart = {
            KEY: 'cart',
            getItems: () => JSON.parse(localStorage.getItem(cart.KEY) || '[]'),
            saveItems: (items) => { localStorage.setItem(cart.KEY, JSON.stringify(items)); window.dispatchEvent(new Event('cartUpdated')); },
            addDenominations: (product, denominationIds) => {
                const items = cart.getItems();
                // Add denominations as separate cart items
                denominationIds.forEach(denomId => {
                    items.push({ 
                        product_id: product.id,
                        product_name: product.name,
                        product_image: product.image_url,
                        denomination_id: denomId.id,
                        denomination_label: denomId.label,
                        price_usd: denomId.price,
                        quantity: 1
                    });
                });
                cart.saveItems(items);
                Swal.fire({ icon: 'success', title: 'Added to Cart!', text: `${denominationIds.length} denomination(s) added to your cart.`, timer: 2000, showConfirmButton: false, toast: true, position: 'top-end' });
            },
            getCount: () => cart.getItems().length
        };

        const checkAuthState = () => {
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            if (token && user) {
                document.getElementById('guestActions').classList.add('hidden');
                document.getElementById('userActions').classList.remove('hidden');
                document.getElementById('userActions').classList.add('flex');
                document.getElementById('walletBalance').textContent = formatCurrency(user.balance_usd || 0);
            }
        };

        const logout = () => { localStorage.removeItem('token'); localStorage.removeItem('user'); window.location.href = '/'; };

        const updateCartBadge = () => {
            const count = cart.getCount();
            const badge = document.getElementById('cartBadge');
            badge.textContent = count;
            badge.style.display = count > 0 ? 'flex' : 'none';
        };

        window.addEventListener('cartUpdated', updateCartBadge);

        // =========================================================
        // PRODUCT LOADING
        // =========================================================
        const getProductId = () => {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        };

        const loadProduct = async () => {
            const productId = getProductId();
            if (!productId) { window.location.href = '/'; return; }

            try {
                const response = await api.get(`/api/products/${productId}`);
                currentProduct = response.data || response || getMockProduct(productId);
                renderProduct(currentProduct);
                await loadDenominations(productId);
            } catch (e) {
                console.error('Error loading product:', e);
                currentProduct = getMockProduct(productId);
                renderProduct(currentProduct);
                loadMockDenominations(productId);
            }
        };

        const loadDenominations = async (productId) => {
            try {
                const response = await api.get(`/api/products/${productId}/denominations`);
                const denominations = response.data || response || [];
                renderDenominations(denominations);
            } catch (e) {
                console.error('Error loading denominations:', e);
                const denominations = getMockDenominations(productId);
                renderDenominations(denominations);
            }
        };

        const renderDenominations = (denominations) => {
            if (!denominations || denominations.length === 0) {
                document.getElementById('denominationsSection').style.display = 'none';
                return;
            }

            document.getElementById('denominationsSection').style.display = 'block';
            
            // If only one denomination, auto-select it
            if (denominations.length === 1) {
                selectedDenominations.set(denominations[0].id, {
                    id: denominations[0].id,
                    label: denominations[0].label,
                    price: denominations[0].price
                });
            }

            const container = document.getElementById('denominationsContainer');
            container.innerHTML = denominations.map(denom => {
                const isSelected = selectedDenominations.has(denom.id);
                const isOutOfStock = denom.stock_quantity <= 0;
                return `
                    <div class="denomination-card ${isSelected ? 'selected' : ''} ${isOutOfStock ? 'disabled' : ''}" 
                         onclick="toggleDenomination('${denom.id}', '${denom.label}', ${denom.price})" 
                         style="cursor: ${isOutOfStock ? 'not-allowed' : 'pointer'};">
                        <div class="p-6 border-2 rounded-lg transition ${isSelected ? 'border-primary bg-blue-50' : 'border-gray-200'} ${isOutOfStock ? 'opacity-50 bg-gray-50' : ''}">
                            <div class="flex items-center justify-between mb-3">
                                <span class="text-lg font-bold text-secondary">${denom.label}</span>
                                <input type="checkbox" ${isSelected ? 'checked' : ''} onclick="event.stopPropagation();" style="width: 20px; height: 20px; cursor: pointer;">
                            </div>
                            <div class="text-2xl font-bold text-primary mb-3">${formatCurrency(denom.price)}</div>
                            <div class="text-sm font-medium ${isOutOfStock ? 'text-danger' : 'text-success'}">
                                ${isOutOfStock ? 'Out of Stock' : `In Stock (${denom.stock_quantity})`}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            updateTotalPrice();
        };

        const renderProduct = (product) => {
            document.getElementById('breadcrumbTitle').textContent = product.name;
            document.title = `${product.name} - KeyVault`;

            document.getElementById('productContent').innerHTML = `
                <!-- Image -->
                <div class="product-image-main">
                    <img src="${product.image_url || 'https://images.unsplash.com/photo-1612287230202-1ff1d85d1bdf?w=800'}" 
                         alt="${product.name}"
                         onerror="this.src='https://images.unsplash.com/photo-1612287230202-1ff1d85d1bdf?w=800'">
                </div>

                <!-- Details -->
                <div>
                    <div class="flex flex-wrap items-center gap-3 mb-4">
                        <span class="platform-badge">
                            <i class="fas fa-gamepad text-primary"></i>
                            ${product.platform || 'Digital'}
                        </span>
                        <span class="text-2xl">${getRegionFlag(product.platform)}</span>
                    </div>

                    <h1 class="text-3xl font-bold text-secondary mb-4">${product.name}</h1>

                    <p class="text-gray-600 leading-relaxed mb-8">${product.short_description || 'Select denominations below to customize your purchase.'}</p>

                    <!-- Trust Badges -->
                    <div class="mt-8 pt-8 border-t border-gray-100">
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div>
                                <i class="fas fa-bolt text-2xl text-primary mb-2"></i>
                                <p class="text-xs text-gray-500">Instant Delivery</p>
                            </div>
                            <div>
                                <i class="fas fa-shield-alt text-2xl text-success mb-2"></i>
                                <p class="text-xs text-gray-500">Secure Payment</p>
                            </div>
                            <div>
                                <i class="fas fa-headset text-2xl text-yellow-500 mb-2"></i>
                                <p class="text-xs text-gray-500">24/7 Support</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Show description
            if (product.description) {
                document.getElementById('productDescription').innerHTML = product.description;
                document.getElementById('descriptionBox').style.display = 'block';
            }
        };

        const toggleDenomination = (denomId, label, price) => {
            const denom = { id: denomId, label: label, price: price };
            if (selectedDenominations.has(denomId)) {
                selectedDenominations.delete(denomId);
            } else {
                selectedDenominations.set(denomId, denom);
            }
            updateTotalPrice();
        };

        const updateTotalPrice = () => {
            let total = 0;
            selectedDenominations.forEach(denom => {
                total += denom.price;
            });
            document.getElementById('totalPrice').textContent = formatCurrency(total);
            
            const checkoutBtn = document.getElementById('checkoutBtn');
            if (selectedDenominations.size > 0) {
                checkoutBtn.disabled = false;
                checkoutBtn.style.opacity = '1';
                checkoutBtn.style.cursor = 'pointer';
            } else {
                checkoutBtn.disabled = true;
                checkoutBtn.style.opacity = '0.5';
                checkoutBtn.style.cursor = 'not-allowed';
            }
        };

        const proceedToCheckout = async () => {
            if (selectedDenominations.size === 0) return;
            
            const denominationIds = Array.from(selectedDenominations.values());
            try {
                cart.addDenominations(currentProduct, denominationIds);
                window.location.href = '/checkout.html';
            } catch (e) {
                console.error('Error adding to cart:', e);
                Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to add items to cart.' });
            }
        };

        // =========================================================
        // RELATED PRODUCTS
        // =========================================================
        const loadRelatedProducts = async () => {
            // Related products are optional in the new model
            document.getElementById('relatedSection').style.display = 'none';
        };

        const getRegionFlag = (platform) => {
            const flags = { 'Steam': 'üåç', 'Xbox': 'üá∫üá∏', 'PlayStation': 'üá∫üá∏', 'Nintendo': 'üáØüáµ' };
            return flags[platform] || 'üåç';
        };

        // =========================================================
        // MOCK DATA
        // =========================================================
        const getMockProduct = (id) => {
            const products = getMockProducts();
            return products.find(p => p.id === parseInt(id)) || products[0];
        };

        const getMockProducts = () => [
            { id: 1, name: 'Xbox Game Pass Ultimate', platform: 'Xbox', image_url: 'https://images.unsplash.com/photo-1621259182978-fbf93132d53d?w=800', short_description: 'Get unlimited access to over 100 high-quality games for console, PC, and Android mobile devices.', description: '<p>Get unlimited access to over 100 high-quality games for console, PC, and Android mobile devices. Includes Xbox Live Gold membership for online multiplayer gaming.</p><ul><li>100+ Games on Console, PC, and Mobile</li><li>Xbox Live Gold included</li><li>EA Play membership included</li><li>New games added regularly</li></ul>' },
            { id: 2, name: 'PlayStation Plus Premium', platform: 'PlayStation', image_url: 'https://images.unsplash.com/photo-1606144042614-b2417e99c4e3?w=800', short_description: 'The ultimate PlayStation membership with access to hundreds of games and online multiplayer.', description: '<p>The ultimate PlayStation membership with access to hundreds of games, online multiplayer, and exclusive benefits.</p>' },
            { id: 3, name: 'Steam Wallet Card', platform: 'Steam', image_url: 'https://images.unsplash.com/photo-1511512578047-dfb367046420?w=800', short_description: 'Add funds to your Steam Wallet instantly for purchasing games and software.', description: '<p>Add funds to your Steam Wallet instantly. Use it to purchase games, software, hardware, and any other item on Steam.</p>' },
        ];

        const getMockDenominations = (productId) => [
            { id: `${productId}-1`, label: '50 UC', price: 9.99, in_stock: true, stock: 'Available' },
            { id: `${productId}-2`, label: '100 UC', price: 19.99, in_stock: true, stock: 'Available' },
            { id: `${productId}-3`, label: '250 UC', price: 49.99, in_stock: true, stock: 'Available' },
        ];

        const loadMockDenominations = (productId) => {
            const denominations = getMockDenominations(productId);
            renderDenominations(denominations);
        };

  // =========================================================
  // MOBILE MENU FUNCTIONALITY
  // =========================================================
  function initMobileMenu() {
  const hamburgerBtn = document.getElementById('hamburgerBtn');
  const mobileMenu = document.getElementById('mobileMenu');
  const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
  const mobileMenuClose = document.getElementById('mobileMenuClose');
  const mobileMenuItems = document.querySelectorAll('.mobile-menu-item');

  hamburgerBtn.addEventListener('click', () => {
  mobileMenu.classList.add('active');
  mobileMenuOverlay.classList.add('active');
  hamburgerBtn.classList.add('active');
  document.body.style.overflow = 'hidden';
  });

  const closeMenu = () => {
  mobileMenu.classList.remove('active');
  mobileMenuOverlay.classList.remove('active');
  hamburgerBtn.classList.remove('active');
  document.body.style.overflow = '';
  };

  mobileMenuClose.addEventListener('click', closeMenu);
  mobileMenuOverlay.addEventListener('click', closeMenu);

  mobileMenuItems.forEach(item => {
  item.addEventListener('click', closeMenu);
  });
  }

  // =========================================================
  // INIT
  // =========================================================
  document.addEventListener('DOMContentLoaded', () => {
  initMobileMenu();
  checkAuthState();
  updateCartBadge();
  loadProduct();
  });

  // Add CSS for denomination cards
  const style = document.createElement('style');
  style.textContent = `
    .denomination-card {
      transition: all 0.3s ease;
    }
    .denomination-card.selected {
      transform: scale(1.02);
    }
    .denomination-card.disabled {
      pointer-events: none;
    }
  `;
  document.head.appendChild(style);
  
  // =========================================================
  // LANGUAGE SELECTION
  // =========================================================
  const selectMobileLanguageFromSelect = () => {
    const select = document.getElementById('mobileLanguageSelect');
    if (!select) return;
    
    const selectedLanguage = select.value;
    changeLanguage(selectedLanguage);
  };

  const changeLanguage = (languageCode) => {
    // Store the selected language
    localStorage.setItem('selectedLanguage', languageCode);
    
    // Update Google Translate
    const googleTranslateCombo = document.querySelector('.');
    if (googleTranslateCombo) {
      googleTranslateCombo.value = languageCode;
      googleTranslateCombo.dispatchEvent(new Event('change'));
    }
  };

  // Initialize language on page load
  document.addEventListener('DOMContentLoaded', () => {
    const savedLanguage = localStorage.getItem('selectedLanguage') || 'en';
    const mobileSelect = document.getElementById('mobileLanguageSelect');
    if (mobileSelect) {
      mobileSelect.value = savedLanguage;
    }
  });
  </script>
<div class="lang-mini">
<script>
    function toggleLangMini() {
      var menu = document.getElementById('lang-mini-menu');
      if (menu) menu.classList.toggle('hidden');
    }
  </script>
<button aria-label="Language" onclick="toggleLangMini()">üåê</button>
<div class="hidden" id="lang-mini-menu">
<button onclick="i18n.setLanguage('en')">EN</button>
<button onclick="i18n.setLanguage('fr')">FR</button>
<button onclick="i18n.setLanguage('es')">ES</button>
<button onclick="i18n.setLanguage('pt')">PT</button>
<button onclick="i18n.setLanguage('de')">DE</button>
<button onclick="i18n.setLanguage('ru')">RU</button>
<button onclick="i18n.setLanguage('ar')">AR</button>
</div>
</div>
<script src="i18n.js"></script></body>
</html>
